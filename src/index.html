<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Best Food</title>

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="./style.css">
    <style>
      .hero {
        text-align: center;
        padding: 100px 20px;
        background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
          url("https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80");
        background-size: cover;
        background-position: center;
        color: white;
      }
    </style>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="container">
        <div class="logo">Best<span>Food</span></div>
        <nav class="nav" id="nav">
          <a href="index.html">Trang chủ</a>
          <a href="menu.html">Thực đơn</a>
          <a href="cart.html">Giỏ hàng</a>
          <a href="about_us.html">Giới thiệu</a>
          <a href="contact.html">Liên hệ</a>
          <a href="booking.html">Đặt bàn online</a>
          <a href="login.html" id="goLogin">Đăng nhập</a>
          <a href="register.html" id="goRegister">Đăng ký</a>
        </nav>
        <div class="mobile-menu" id="mobileMenu">
          <i class="fas fa-bars"></i>
        </div>
      </div>
    </header>

    <!-- Hero -->
    <section class="hero">
      <div class="container">
        <h1>Món ăn ngon nhất cho khẩu vị của bạn</h1>
        <p>
          Khám phá thực đơn hấp dẫn của chúng tôi với nguyên liệu tươi ngon và đam mê nấu nướng
        </p>
        <a href="menu.html" class="btn">Xem Thực Đơn</a>

        <div class="menu-browse">
          <div class="menu-card">
            <i class="fas fa-utensils"></i>
            <h3>Khai vị</h3>
            <p>Bắt đầu bữa ăn đúng cách</p>
          </div>
          <div class="menu-card">
            <i class="fas fa-hamburger"></i>
            <h3>Món chính</h3>
            <p>No nê và hấp dẫn</p>
          </div>
          <div class="menu-card">
            <i class="fas fa-ice-cream"></i>
            <h3>Tráng miệng</h3>
            <p>Kết thúc ngọt ngào</p>
          </div>
          <div class="menu-card">
            <i class="fas fa-cocktail"></i>
            <h3>Đồ uống</h3>
            <p>Giải khát sảng khoái</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Healthy -->
    <section class="healthy-section">
      <div class="container">
        <div class="healthy-text">
          <h2>Chúng tôi mang đến bữa ăn lành mạnh cho gia đình bạn</h2>
          <p>
            Đầu bếp của chúng tôi chỉ sử dụng nguyên liệu tươi ngon nhất để tạo ra những món ăn bổ dưỡng và hấp dẫn mà cả gia đình bạn sẽ yêu thích.
          </p>
          <a href="#" class="btn">Tìm hiểu thêm</a>
        </div>

        <div class="healthy-card">
          <i class="fas fa-heart"></i>
          <h3>Đặt món theo yêu cầu</h3>
          <p>
            Hãy cho chúng tôi biết chế độ ăn uống của bạn và chúng tôi sẽ chuẩn bị món ăn phù hợp
          </p>
        </div>
      </div>
    </section>

    <!-- Catering -->
    <section class="catering-section">
      <div class="container">
        <h2 class="section-title">Dịch vụ tiệc của chúng tôi</h2>
        <div class="catering-grid">
          <div class="catering-card">
            <i class="fas fa-glass-cheers"></i>
            <h3>Tiệc cưới</h3>
            <p>
              Biến ngày trọng đại của bạn trở nên đáng nhớ với thực đơn sang trọng.
            </p>
          </div>
          <div class="catering-card">
            <i class="fas fa-briefcase"></i>
            <h3>Sự kiện công ty</h3>
            <p>
              Tạo ấn tượng với khách hàng và đồng nghiệp bằng dịch vụ chuyên nghiệp.
            </p>
          </div>
          <div class="catering-card">
            <i class="fas fa-birthday-cake"></i>
            <h3>Tiệc riêng tư</h3>
            <p>Từ sinh nhật đến kỷ niệm, chúng tôi đều có thể phục vụ.</p>
          </div>
          <div class="catering-card">
            <i class="fas fa-calendar-alt"></i>
            <h3>Sự kiện đặc biệt</h3>
            <p>Lễ hội, lễ tốt nghiệp và nhiều hơn nữa - chúng tôi đều lo được.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Delivery -->
    <section class="delivery-section">
      <div class="container">
        <div class="delivery-image">
          <img
            src="https://kamereo.vn/blog/wp-content/uploads/2019/05/freepik_featured_delivery-930x620.jpg"
            alt="Giao đồ ăn"
          />
        </div>
        <div class="delivery-text">
          <h2>Dịch vụ giao hàng nhanh nhất thành phố</h2>
          <p>
            Chúng tôi đảm bảo giao hàng trong vòng 30 phút hoặc miễn phí! Đội ngũ giao hàng tận tâm luôn giữ đồ ăn nóng hổi và tươi ngon.
          </p>

          <div class="special-offers">
            <h3>Ưu đãi đặc biệt</h3>
            <ul>
              <li>Miễn phí giao hàng cho đơn trên 500.000đ</li>
              <li>Giảm 20% cho đơn online đầu tiên</li>
              <li>Chương trình tích điểm - nhận thưởng cho mỗi đơn hàng</li>
            </ul>
          </div>

          <a href="#" class="btn">Đặt ngay</a>
        </div>
      </div>
    </section>

    <!-- Testimonials -->
    <section class="testimonials">
      <div class="container">
        <h2 class="section-title">Khách hàng nói gì</h2>
        <div class="testimonial-grid">
          <div class="testimonial">
            <div class="testimonial-content">
              <p>
                "Đồ ăn ở đây thực sự tuyệt vời! Tôi đã là khách quen hơn một năm và luôn ấn tượng với chất lượng."
              </p>
              <div class="testimonial-author">
                <img
                  src="https://randomuser.me/api/portraits/women/32.jpg"
                  alt="Khách hàng"
                />
                <div>
                  <h4>Sarah Johnson</h4>
                  <p>Khách hàng thường xuyên</p>
                </div>
              </div>
            </div>
          </div>

          <div class="testimonial">
            <div class="testimonial-content">
              <p>
                "Chúng tôi đã thuê BestFood cho sự kiện công ty và mọi người đều khen ngợi. Dịch vụ chuyên nghiệp và thực đơn ngon!"
              </p>
              <div class="testimonial-author">
                <img
                  src="https://randomuser.me/api/portraits/men/46.jpg"
                  alt="Khách hàng"
                />
                <div>
                  <h4>Michael Chen</h4>
                  <p>Người tổ chức sự kiện</p>
                </div>
              </div>
            </div>
          </div>

          <div class="testimonial">
            <div class="testimonial-content">
              <p>
                "Là người có chế độ ăn kiêng, tôi rất thích cách họ phục vụ. Các món không gluten vẫn rất ngon!"
              </p>
              <div class="testimonial-author">
                <img
                  src="https://randomuser.me/api/portraits/women/65.jpg"
                  alt="Khách hàng"
                />
                <div>
                  <h4>Emily Rodriguez</h4>
                  <p>Thực khách quan tâm sức khỏe</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Blog -->
    <section class="blog-section">
      <div class="container">
        <h2 class="section-title">Bài viết mới nhất</h2>
        <div class="blog-grid" id="blogGrid"></div>
        <div id="blogError" class="alert" style="display:none"></div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-column">
            <h3>BestFood</h3>
            <p>
              Phục vụ đam mê ẩm thực từ 2010. Chúng tôi cam kết mang đến trải nghiệm ăn uống tốt nhất.
            </p>
            <div class="social-icons">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-pinterest"></i></a>
            </div>
          </div>

          <div class="footer-column">
            <h3>Liên kết nhanh</h3>
            <ul>
              <li><a href="#">Trang chủ</a></li>
              <li><a href="#">Thực đơn</a></li>
              <li><a href="#">Giới thiệu</a></li>
              <li><a href="#">Liên hệ</a></li>
              <li><a href="#">Tuyển dụng</a></li>
            </ul>
          </div>

          <div class="footer-column">
            <h3>Thông tin liên hệ</h3>
            <ul>
              <li>
                <i class="fas fa-map-marker-alt"></i> 123 Đường Food, Thành phố, Quốc gia
              </li>
              <li><i class="fas fa-phone"></i> (555) 123-4567</li>
              <li><i class="fas fa-envelope"></i> info@bestfood.com</li>
              <li><i class="fas fa-clock"></i> Thứ 2 - CN: 10h - 22h</li>
            </ul>
          </div>

          <div class="footer-column">
            <h3>Bản tin</h3>
            <p>Đăng ký để nhận ưu đãi và tin tức mới nhất.</p>
            <form id="newsletterForm">
              <input type="email" placeholder="Email của bạn" required />
              <button type="submit" class="btn">Đăng ký</button>
            </form>
          </div>
        </div>

        <div class="footer-bottom">
          <p>
            &copy; 2023 BestFood. Mọi quyền được bảo lưu. | Thiết kế với
            <i class="fas fa-heart"></i>
          </p>
        </div>
      </div>
    </footer>

    <!-- Chat widget (paste before </body>) -->
<div class="chat-widget" id="chatWidgetRoot" aria-live="polite">
  <!-- Toggle button -->
  <button class="chat-toggle" id="chatToggle" title="Hỗ trợ">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M21 15a2 2 0 0 1-2 2H8l-5 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10z" fill="currentColor"/>
    </svg>
    <span class="badge" id="chatBadge" style="display:none">0</span>
  </button>

  <!-- Panel (hidden by default) -->
  <div class="chat-panel" id="chatPanel" style="display:none" role="dialog" aria-label="Hộp thoại hỗ trợ">
    <div class="chat-header">
      <div class="chat-mini">
        <strong class="title">Hỗ trợ trực tuyến</strong>
        <div class="muted-small" style="font-size:12px; margin-left:6px; opacity:.9">Trực tuyến</div>
      </div>
      <button class="close-btn" id="chatClose" aria-label="Đóng chat">&times;</button>
    </div>

    <div class="chat-messages" id="chatMessages" aria-live="polite" aria-atomic="false">
      <!-- messages sẽ được render ở đây -->
    </div>

    <div class="chat-input">
      <input id="chatInput" placeholder="Gõ tin nhắn..." aria-label="Nhập tin nhắn" />
      <button class="send" id="chatSend">Gửi</button>
    </div>
  </div>
</div>
<!-- End chat widget -->

    <script>
      (function () {
        const TOKEN_KEY = 'bestfood_token';
        const USER_KEY  = 'currentUser';

        const token = localStorage.getItem(TOKEN_KEY);
        let user = null;
        try { user = JSON.parse(localStorage.getItem(USER_KEY) || '{}'); } catch {}

        const nav = document.querySelector('.nav');
        if (nav) {
          const linkLogin    = nav.querySelector('a[href$="login.html"]');
          const linkRegister = nav.querySelector('a[href$="register.html"]');

          const el = (tag, attrs = {}, text = '') => {
            const x = document.createElement(tag);
            Object.entries(attrs).forEach(([k, v]) => x.setAttribute(k, v));
            if (text) x.textContent = text;
            return x;
          };

          if (token) {
            if (linkLogin)    linkLogin.style.display = 'none';
            if (linkRegister) linkRegister.style.display = 'none';

            if (!nav.querySelector('#navUserBadge')) {
              const dot = el('span', { class:'dot' }, '•');
              const badge = el('span', { id:'navUserBadge', class:'pill' },
                  (user && (user.name || user.phone)) ? (user.name || user.phone) : 'Đã đăng nhập');
              const logout = el('a', { href:'#', id:'navLogout' }, 'Đăng xuất');
              logout.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem(TOKEN_KEY);
                localStorage.removeItem(USER_KEY);
                location.href = 'index.html';
              });
              nav.appendChild(dot);
              nav.appendChild(badge);
              nav.appendChild(logout);
            }
          } else {
            if (linkLogin)    linkLogin.style.display = '';
            if (linkRegister) linkRegister.style.display = '';
            const badge  = nav.querySelector('#navUserBadge');
            const logout = nav.querySelector('#navLogout');
            if (badge)  badge.remove();
            if (logout) logout.remove();
          }
        }
        const phoneInput = document.querySelector('#phone');
        if (phoneInput && user && user.phone) {
          phoneInput.value = user.phone;
        }
      })();
</script>

<script>
(function(){
  const KEY_MESSAGES = 'bestfood_chat_messages_v1';
  const KEY_OPEN = 'bestfood_chat_open_v1';

  const root = document.getElementById('chatWidgetRoot');
  if(!root) return; // nothing to do

  const toggle = document.getElementById('chatToggle');
  const panel  = document.getElementById('chatPanel');
  const closeBtn = document.getElementById('chatClose');
  const messagesEl = document.getElementById('chatMessages');
  const input = document.getElementById('chatInput');
  const sendBtn = document.getElementById('chatSend');
  const badge = document.getElementById('chatBadge');

  // Utils
  function loadMessages(){ try { return JSON.parse(localStorage.getItem(KEY_MESSAGES) || '[]'); } catch { return []; } }
  function saveMessages(arr){ localStorage.setItem(KEY_MESSAGES, JSON.stringify(arr)); }
  function setOpen(v){ localStorage.setItem(KEY_OPEN, v ? '1':'0'); }
  function getOpen(){ return localStorage.getItem(KEY_OPEN) === '1'; }

  function scrollToBottom(){ messagesEl.scrollTop = messagesEl.scrollHeight; }

  // render messages
  function render(){
    const msgs = loadMessages();
    messagesEl.innerHTML = msgs.map(m=>{
      const cls = m.from === 'user' ? 'msg user' : 'msg bot';
      // simple timestamp optional
      return `<div class="${cls}" title="${new Date(m.t||0).toLocaleString()}">${escapeHtml(m.text)}</div>`;
    }).join('');
    // unread badge (count bot messages since last open)
    updateBadge();
    scrollToBottom();
  }

  function escapeHtml(s){
    return String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  // unread badge logic: count bot messages after lastSeen timestamp
  function updateBadge(){
    const msgs = loadMessages();
    const lastSeen = Number(localStorage.getItem(KEY_OPEN+'_last_seen') || 0);
    const unread = msgs.filter(m => m.from === 'bot' && (m.t||0) > lastSeen).length;
    if(unread > 0){ badge.style.display = 'inline-flex'; badge.textContent = unread; }
    else badge.style.display = 'none';
  }

  // open/close
  function openPanel(){
    panel.style.display = 'flex';
    setOpen(true);
    localStorage.setItem(KEY_OPEN+'_last_seen', String(Date.now()));
    updateBadge();
  }
  function closePanel(){
    panel.style.display = 'none';
    setOpen(false);
  }

  // initial state (respect previously saved)
  if(getOpen()) openPanel(); else closePanel();
  render();

  // events
  toggle.addEventListener('click', ()=>{
    const isOpen = panel.style.display !== 'none';
    if(isOpen) closePanel();
    else openPanel();
  });
  closeBtn.addEventListener('click', closePanel);

  sendBtn.addEventListener('click', sendMessageFromInput);
  input.addEventListener('keydown', (e) => {
    if(e.key === 'Enter') sendMessageFromInput();
  });

  function sendMessageFromInput(){
    const txt = (input.value || '').trim();
    if(!txt) return;
    addMessage('user', txt);
    input.value = '';
    // demo bot reply (replace with real backend call)
    setTimeout(()=> {
      addMessage('bot', `Cảm ơn bạn! Mình đã nhận: "${txt}". (Đây là trả lời demo.)`);
    }, 500);
  }

  function addMessage(from, text){
    const msgs = loadMessages();
    msgs.push({ from, text, t: Date.now() });
    saveMessages(msgs);
    render();
    // notify other tabs
    try { window.dispatchEvent(new StorageEvent('storage',{key:KEY_MESSAGES,newValue:JSON.stringify(msgs)})); } catch(e){}
  }

  // sync across tabs/pages
  window.addEventListener('storage', (e)=>{
    if(!e) return;
    if(e.key === KEY_MESSAGES || e.key === (KEY_OPEN) || e.key === (KEY_OPEN+'_last_seen')){
      // re-render to reflect changes
      if(panel.style.display !== 'none') localStorage.setItem(KEY_OPEN+'_last_seen', String(Date.now()));
      render();
      if(getOpen()) panel.style.display = 'flex';
      else panel.style.display = 'none';
    }
  });

  // small accessibility: focus input when opened
  const obs = new MutationObserver(() => {
    if(panel.style.display !== 'none') setTimeout(()=> input.focus(), 50);
  });
  obs.observe(panel, { attributes: true, attributeFilter: ['style'] });

})();
</script>

<script>
    const API_BASE = 'http://localhost/CS403_BE-master/public/api';
    const URL_BLOG = API_BASE + '/blog/data';
    const $ = s => document.querySelector(s);
    const show = (el, on=true) => el.style.display = on ? 'block' : 'none';

    function fmtDate(d){
      if(!d) return '';
      try{ const parts = d.split(' ')[0].split('-'); return `${parts[2]}/${parts[1]}/${parts[0]}`; }catch{return d;}
    }
    function truncate(s, n=120){ if(!s) return ''; return s.length>n? s.slice(0,n-1)+'…' : s; }
    function blogImage(src){ return src && src.trim()? src : 'https://images.unsplash.com/photo-1504754524776-8f4f37790ca0?auto=format&fit=crop&w=1200&q=60'; }

    function renderBlogs(items){
      const grid = $('#blogGrid');
      if(!grid) return;
      if(!Array.isArray(items) || items.length===0){
        grid.innerHTML = `<div class="muted" style="padding:12px 0">Chưa có bài viết nào.</div>`;
        return;
      }
      grid.innerHTML = items.map(b=>{
        const img   = blogImage(b.hinh_anh);
        const title = b.title || 'Bài viết';
        const desc  = truncate(b.mo_ta_ngan || b.description || '');
        const date  = fmtDate(b.ngay_dang || b.created_at || '');
        const id    = b.id;
        const cmt   = typeof b.so_binh_luan !== 'undefined' ? `<span><i class="far fa-comment"></i> ${b.so_binh_luan} bình luận</span>` : '';
        return `
          <div class="blog-card">
            <div class="blog-image" style="background-image:url('${img}');"></div>
            <div class="blog-content">
              <h3>${title}</h3>
              <div class="blog-meta">
                <span><i class="far fa-calendar"></i> ${date}</span>
                ${cmt}
              </div>
              <p>${desc}</p>
              <a href="blog-detail.html?id=${encodeURIComponent(id)}" class="btn btn-small">Đọc thêm</a>
            </div>
          </div>
        `;
      }).join('');
    }

    async function loadBlogs(){
      const grid  = $('#blogGrid');
      const alert = $('#blogError');
      if(grid) grid.innerHTML = `<div class="muted" style="padding:12px 0">Đang tải bài viết…</div>`;
      show(alert, false);
      try{
        const res = await fetch(URL_BLOG, { headers:{Accept:'application/json'} });
        let data=null, raw=null;
        try { data=await res.json(); } catch { raw=await res.text(); }
        if(!res.ok) throw new Error((data&&data.message)||raw||`HTTP ${res.status}`);
        const items = Array.isArray(data?.data)? data.data : (Array.isArray(data)? data : []);
        renderBlogs(items);
      }catch(err){
        console.error(err);
        if(grid) grid.innerHTML = '';
        if(alert){ alert.textContent = 'Không tải được danh sách bài viết.'; show(alert, true); }
      }
    }

    document.addEventListener('DOMContentLoaded', loadBlogs);
  </script>
  <!-- <script>
    (function () {
      // ==== CONFIG ====
      const API_BASE = (window.API_BASE) || 'http://localhost/CS403_BE-master/public/api';
      const SELECTORS = {
        btn:        '#chatbotBtn',
        win:        '#chatWindow',
        close:      '#closeChat',
        input:      '#chatInput',
        send:       '#sendBtn',
        messages:   '#chatMessages',
      };
      const STORE_KEY = 'bf_chat_history_v1';

      const $ = s => document.querySelector(s);
      const btn   = $(SELECTORS.btn);
      const win   = $(SELECTORS.win);
      const close = $(SELECTORS.close);
      const input = $(SELECTORS.input);
      const send  = $(SELECTORS.send);
      const box   = $(SELECTORS.messages);

      if (!btn || !win || !close || !input || !send || !box) return;

      function loadHistory() {
        try {
          const raw = localStorage.getItem(STORE_KEY);
          return raw ? JSON.parse(raw) : [];
        } catch { return []; }
      }
      function saveHistory(arr) {
        try { localStorage.setItem(STORE_KEY, JSON.stringify(arr)); } catch {}
      }

      let history = loadHistory();
      if (history.length) {
        box.innerHTML = '';
        history.forEach(m => addMessage(m.role, m.html || escapeHtml(m.text)));
      }
      function escapeHtml(s='') {
        return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
      }
      function addMessage(role, html) {
        const div = document.createElement('div');
        div.className = 'message ' + (role === 'user' ? 'user-message' : 'bot-message');
        div.innerHTML = html;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight + 200;
        history.push({ role, html });
        saveHistory(history);
      }
      function typing(on=true) {
        let el = $('#bf-typing');
        if (on) {
          if (!el) {
            el = document.createElement('div');
            el.id = 'bf-typing';
            el.className = 'message bot-message';
            el.innerHTML = 'Đang gõ<span class="dotting">...</span>';
            box.appendChild(el);
            box.scrollTop = box.scrollHeight + 200;
          }
        } else {
          if (el) el.remove();
        }
      }
      function reply(html, delay=500) {
        typing(true);
        setTimeout(() => { typing(false); addMessage('bot', html); }, delay);
      }
      function pill(text) {
        return `<span class="pill" style="margin-right:6px">${escapeHtml(text)}</span>`;
      }
      function link(href, text) {
        return `<a href="${href}" target="_blank" rel="noopener" style="color:var(--red);text-decoration:none;font-weight:600">${escapeHtml(text)}</a>`;
      }
      function intentOf(s) {
        const q = s.toLowerCase().normalize('NFC');
        if (/(menu|thực đơn|mon an|món ăn)/.test(q)) return 'menu';
        if (/(giờ|mở cửa|open|closing)/.test(q)) return 'hours';
        if (/(đặt bàn|dat ban|reserve|booking)/.test(q)) return 'booking';
        if (/(giao hàng|ship|delivery|giao do)/.test(q)) return 'delivery';
        if (/(khuyến mãi|ưu đãi|promo|sale|voucher)/.test(q)) return 'promo';
        if (/(liên hệ|contact|điện thoại|email|địa chỉ)/.test(q)) return 'contact';
        if (/(blog|bài viết|tin tức)/.test(q)) return 'blog';
        if (/(đăng nhập|login|đăng ký|register)/.test(q)) return 'auth';
        if (/(xóa lịch sử|xoá lịch sử|clear history)/.test(q)) return 'clear';
        return 'chitchat';
      }
      async function handleMenu() {
        try {
          const res = await fetch(`${API_BASE}/thuc-don/data`, { headers:{Accept:'application/json'} });
          const data = await res.json();
          const items = Array.isArray(data?.data) ? data.data : (Array.isArray(data)?data:[]);
          if (!items.length) return reply('Hiện chưa có món nào trong thực đơn.');
          const first = items.slice(0, 6).map(m => `
            <div style="display:flex;align-items:center;gap:10px;margin:6px 0">
              <div style="flex:1">
                <div style="font-weight:700">${escapeHtml(m.ten_mon_an || m.ten || 'Món')}</div>
                <div class="muted" style="font-size:12px">${escapeHtml(m.mo_ta || '')}</div>
              </div>
              <div style="white-space:nowrap;font-weight:700">${(m.gia || m.gia_ban || 0).toLocaleString('vi-VN')}đ</div>
            </div>
          `).join('');
          reply(`<div>Đây là một vài món nổi bật:</div>${first}<div style="margin-top:8px">${pill('gợi ý')} Gõ “đặt bàn” nếu bạn muốn giữ bàn nhé!</div>`);
        } catch {
          reply('Không tải được thực đơn. Bạn có thể vào trang ' + link('menu.html','Thực đơn') + ' để xem chi tiết.');
        }
      }

      async function handleBlog() {
        try {
          const res = await fetch(`${API_BASE}/blog/data`, { headers:{Accept:'application/json'} });
          const data = await res.json();
          const items = Array.isArray(data?.data) ? data.data : (Array.isArray(data)?data:[]);
          if (!items.length) return reply('Chưa có bài viết nào.');
          const list = items.slice(0,3).map(b=>`
            <div style="margin:6px 0">
              <div style="font-weight:700">${escapeHtml(b.title || 'Bài viết')}</div>
              <div class="muted" style="font-size:12px">${escapeHtml(b.mo_ta_ngan || '')}</div>
            </div>`).join('');
          reply(`<div>Bài viết mới:</div>${list}<div style="margin-top:8px">${link('index.html#blog','Xem thêm ở trang chủ')}</div>`);
        } catch {
          reply('Không tải được danh sách bài viết. Vui lòng thử lại sau.');
        }
      }

      function handleHours() {
        reply(`Giờ mở cửa của BestFood:
          <ul style="margin:6px 0 0 18px;line-height:1.6">
            <li>Thứ 2 – Chủ nhật: <b>10:00 – 22:00</b></li>
          </ul>`);
      }

      function handleBooking() {
        reply(`Bạn có thể giữ bàn trực tiếp tại ${link('datbanonl.html','Đặt bàn online')}.
        Gợi ý: Chuẩn bị sẵn <b>SĐT</b>, <b>ngày</b> và <b>giờ</b> bạn muốn đến nhé!`);
      }

      function handleDelivery() {
        reply(`Hiện chúng tôi giao hàng qua:
          <ul style="margin:6px 0 0 18px;line-height:1.6">
            <li>Đặt trực tiếp trên web/app BestFood</li>
            <li>Đối tác: GrabFood, ShopeeFood (tuỳ khu vực)</li>
          </ul>
          ${pill('mẹo')} Miễn phí giao cho đơn trên 500.000đ.`);
      }

      function handlePromo() {
        reply(`Ưu đãi hiện có:
          <ul style="margin:6px 0 0 18px;line-height:1.6">
            <li>Giảm <b>20%</b> cho đơn online đầu tiên</li>
            <li>Miễn phí giao cho đơn từ <b>500.000đ</b></li>
          </ul>`);
      }

      function handleContact() {
        reply(`Liên hệ BestFood:
          <ul style="margin:6px 0 0 18px;line-height:1.6">
            <li><i class="fas fa-map-marker-alt"></i> 123 Đường Food, Thành phố</li>
            <li><i class="fas fa-phone"></i> (555) 123-4567</li>
            <li><i class="fas fa-envelope"></i> info@bestfood.com</li>
          </ul>`);
      }

      function handleAuth() {
        reply(`Bạn có thể ${link('login.html','đăng nhập')} hoặc ${link('register.html','đăng ký')} tài khoản để dùng đầy đủ tính năng (như giữ bàn, lưu đơn hàng…).`);
      }

      function handleChitChat(text) {
        const bank = [
          'Tớ đây! Bạn cần mình giúp gì nào?',
          'Mình có thể giúp bạn xem thực đơn, giờ mở cửa, đặt bàn…',
          'Bạn có thể gõ: "menu", "đặt bàn", "giao hàng", "blog", "liên hệ"…'
        ];
        const pick = bank[Math.floor(Math.random()*bank.length)];
        reply(pick);
      }

      function handleClear() {
        history = [];
        saveHistory(history);
        box.innerHTML = '';
        reply('Đã xoá lịch sử chat.');
      }
      function sendUser() {
        const val = (input.value || '').trim();
        if (!val) return;
        addMessage('user', escapeHtml(val));
        input.value = '';

        const i = intentOf(val);
        switch (i) {
          case 'menu':    return handleMenu();
          case 'hours':   return handleHours();
          case 'booking': return handleBooking();
          case 'delivery':return handleDelivery();
          case 'promo':   return handlePromo();
          case 'contact': return handleContact();
          case 'blog':    return handleBlog();
          case 'auth':    return handleAuth();
          case 'clear':   return handleClear();
          default:        return handleChitChat(val);
        }
      }
      btn.addEventListener('click', () => { win.style.display = 'block'; input.focus(); });
      close.addEventListener('click', () => { win.style.display = 'none'; });
      send.addEventListener('click', sendUser);
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendUser(); }
      });
      if (!sessionStorage.getItem('bf_chat_hint')) {
        sessionStorage.setItem('bf_chat_hint','1');
        setTimeout(()=> {
          if (win.style.display !== 'block') {
            btn.classList.add('pulse');
            setTimeout(()=>btn.classList.remove('pulse'), 2500);
          }
        }, 1200);
      }
    })();
    </script> -->

  </body>
</html>
